# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Stack Deployment (Security Enhanced)

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å —É—á–µ—Ç–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –°–±–µ—Ä–±–∞–Ω–∫–∞.

## üõ°Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –°–∫—Ä–∏–ø—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **iptables-wrapper.sh** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **curl-wrapper.sh** - –≤–∞–ª–∏–¥–∞—Ü–∏—è URL –∏ —Ç–æ–∫–µ–Ω–æ–≤  
- **file-operations-wrapper.sh** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤
- **systemctl-wrapper.sh** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

### 2. NOEXEC –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è systemctl status
```bash
# –í sudoers:
ALL=(ALL:ALL) NOEXEC: NOPASSWD: /opt/monitoring/wrappers/systemctl-wrapper.sh status prometheus
```

### 3. –Ø–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ sudoers
- –£–±—Ä–∞–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ø—Ä–∞–≤–∏–ª sudoers
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —è–≤–Ω—ã–µ –ø—É—Ç–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö-–æ–±–µ—Ä—Ç–∫–∞—Ö

### 4. –û—á–∏—Å—Ç–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –ø–∞—Ä–æ–ª—è–º–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–∞—Ä–æ–ª–µ–π

### 5. –ë–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã: 9090, 3000, 12990, 12991, 13000:14000
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏: 127.0.0.1, localhost, SERVER_IP
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã: simple-api.rlm.apps.prom-terra000049-ebm.ocp.sigma.sbrf.ru, infra.nexus.sigma.sbrf.ru
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
monitoring-deployment/
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ deploy_monitoring.sh           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ wrapper-scripts/               # –°–∫—Ä–∏–ø—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è sudo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ iptables-wrapper.sh        # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è iptables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ curl-wrapper.sh            # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è curl
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file-operations-wrapper.sh # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ systemctl-wrapper.sh       # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è systemctl
‚îÇ   ‚îî‚îÄ‚îÄ validation/                    # –°–∫—Ä–∏–ø—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ validate-ports.sh          # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ validate-ip.sh             # –í–∞–ª–∏–¥–∞—Ü–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ validate-url.sh            # –í–∞–ª–∏–¥–∞—Ü–∏—è URL
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ sudoers-template               # –®–∞–±–ª–æ–Ω sudoers —Å NOEXEC
‚îÇ   ‚îî‚îÄ‚îÄ security-config.sh             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Jenkinsfile                        # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Jenkins pipeline
‚îî‚îÄ‚îÄ README.md                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <repository-url>
cd monitoring-deployment

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã
chmod +x scripts/*.sh
chmod +x scripts/wrapper-scripts/*.sh
chmod +x scripts/validation/*.sh
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `Jenkinsfile` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã pipeline —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. –ó–∞–ø—É—Å–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
sudo scripts/deploy_monitoring.sh

# –ß–µ—Ä–µ–∑ Jenkins
# –ó–∞–ø—É—Å—Ç–∏—Ç—å pipeline —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
# - SERVER_ADDRESS
# - SSH_CREDENTIALS_ID  
# - SEC_MAN_ADDR
# - –∏ –¥—Ä—É–≥–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### Sudoers –ø—Ä–∞–≤–∏–ª–∞
–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ sudoers —Ç–µ–ø–µ—Ä—å:
- –Ø–≤–Ω—ã–µ –±–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç NOEXEC –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- –ü—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏

–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª:
```bash
# –ë–µ–∑ NOEXEC - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∏
ALL=(ALL:ALL) NOPASSWD: /usr/bin/systemctl is-active prometheus

# –° NOEXEC - –∫–æ–º–∞–Ω–¥—ã status
ALL=(ALL:ALL) NOEXEC: NOPASSWD: /opt/monitoring/wrappers/systemctl-wrapper.sh status prometheus

# –°–∫—Ä–∏–ø—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
ALL=(ALL:ALL) NOPASSWD: /opt/monitoring/wrappers/iptables-wrapper.sh add-prometheus-rule 127.0.0.1 9090
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
–í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é:

```bash
# –ü–æ—Ä—Ç—ã
validate_port "9090"    # OK
validate_port "8080"    # ERROR - –Ω–µ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ

# IP –∞–¥—Ä–µ—Å–∞
validate_ip "127.0.0.1" # OK
validate_ip "192.168.1.1" # ERROR - –Ω–µ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ

# URL
validate_url "https://simple-api.rlm.apps.prom-terra000049-ebm.ocp.sigma.sbrf.ru/api/tasks" # OK
validate_url "http://example.com" # ERROR - –Ω–µ HTTPS
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Linux —Å–µ—Ä–≤–µ—Ä (Fedora/RHEL/CentOS)
- Bash 4.0+
- sudo —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π NOEXEC
- systemd
- –î–æ—Å—Ç—É–ø –∫ Vault –∏ RLM

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–∞–≤–∞ root –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –î–æ—Å—Ç—É–ø –∫ Vault –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- SSH –¥–æ—Å—Ç—É–ø –∫ —Ü–µ–ª–µ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- –î–æ—Å—Ç—É–ø –∫ RLM API

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö-–æ–±–µ—Ä—Ç–∫–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –±–µ–ª—ã–º —Å–ø–∏—Å–∫–∞–º

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ sudoers —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `visudo -c` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–∫—Ä–∏–ø—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ `/opt/monitoring/wrappers/`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤:
- `/var/log/monitoring-wrapper.log` - –¥–µ–π—Å—Ç–≤–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤-–æ–±–µ—Ä—Ç–æ–∫
- `$HOME/monitoring_deployment_*.log` - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—â–∞—Ç—å—Å—è:
- –†–æ–º–∞–Ω –ì–∏–ª—è–∑–æ–≤: RVGilyazov@sberbank.ru
- –°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ IDM: @idminfra

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –°–±–µ—Ä–±–∞–Ω–∫–µ —Å —É—á–µ—Ç–æ–º –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

**–í–µ—Ä—Å–∏—è**: 4.0 (Security Enhanced)  
**–î–∞—Ç–∞**: $(date +%Y-%m-%d)  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
